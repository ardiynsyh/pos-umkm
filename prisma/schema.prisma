// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  nama      String
  email     String   @unique
  password  String
  role      UserRole @default(KASIR)
  outletId  String?
  outlet    Outlet?  @relation(fields: [outletId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

enum UserRole {
  ADMIN
  KASIR
  MANAGER
}

model Outlet {
  id           String        @id @default(cuid())
  nama         String
  alamat       String?
  telepon      String?
  users        User[]
  products     Product[]
  transactions Transaction[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("outlets")
}

model Category {
  id        String    @id @default(cuid())
  nama      String
  deskripsi String?
  products  Product[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("categories")
}

model Product {
  id               String            @id @default(cuid())
  sku              String            @unique
  barcode          String?           @unique
  nama             String
  deskripsi        String?
  categoryId       String
  category         Category          @relation(fields: [categoryId], references: [id])
  hargaBeli        Float             @default(0)
  hargaJual        Float
  stok             Int               @default(0)
  stokMinimal      Int               @default(5)
  satuan           String            @default("pcs")
  foto             String?
  outletId         String
  outlet           Outlet            @relation(fields: [outletId], references: [id])
  transactionItems TransactionItem[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  @@index([barcode])
  @@index([sku])
  @@map("products")
}

model Transaction {
  id               String            @id @default(cuid())
  nomorTransaksi   String            @unique
  total            Float
  diskon           Float             @default(0)
  pajak            Float             @default(0)
  totalBayar       Float
  uangDibayar      Float
  kembalian        Float
  metodePembayaran PaymentMethod     @default(TUNAI)
  status           TransactionStatus @default(BERHASIL)
  kasir            String?
  pelanggan        String?
  catatan          String?
  outletId         String
  outlet           Outlet            @relation(fields: [outletId], references: [id])
  items            TransactionItem[]
  isSynced         Boolean           @default(true)
  syncedAt         DateTime?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  @@index([nomorTransaksi])
  @@index([createdAt])
  @@map("transactions")
}

enum PaymentMethod {
  TUNAI
  DEBIT
  KREDIT
  QRIS
  TRANSFER
}

enum TransactionStatus {
  BERHASIL
  TERTUNDA
  DIBATALKAN
}

model TransactionItem {
  id            String      @id @default(cuid())
  transactionId String
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  productId     String
  product       Product     @relation(fields: [productId], references: [id])
  namaProduk    String
  quantity      Int
  hargaSatuan   Float
  subtotal      Float
  createdAt     DateTime    @default(now())

  @@map("transaction_items")
}